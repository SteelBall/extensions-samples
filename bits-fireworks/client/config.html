<!DOCTYPE html>
<html>

<head>
  <script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
  <script src="js/extension.js"></script>
  <script src="js/fireworks.js"></script>
  <script src="js/jquery.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <link href="css/nes.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>

<body style="background-color:#212529">
  <script type="text/javascript">
  var twitch = window.Twitch ? window.Twitch.ext : null;
(function() {  
    var sku = "";

    if(!twitch){
      return;
    }

    twitch.configuration.onChanged(function () {
      sku = twitch.configuration.broadcaster ? twitch.configuration.broadcaster.content : ""
      log("onChanged() fired, previously broadcaster-selected sku: " + sku)
    })

    twitch.bits.getProducts().then(function (products) {
      products.sort(compare);

      var elementsToRender = [];
      for (var i = 0; i < products.length; i++) {
        var radioBtn = '<label><input type="radio" class="nes-radio is-dark" name="firework" id="' + products[i].sku + '" /><span>' + products[i].displayName + '</span></label>';
        elementsToRender.push(radioBtn);
        log(radioBtn)
      }
      $("#configuration").after(elementsToRender);

      if (sku != "") {
        var radioBtn = document.getElementById(sku);
        radioBtn.checked = true;
      }
    });
    })()

    function saveSettings() {
      var radioBtns = document.getElementsByName('firework');

      for (var i = 0, length = radioBtns.length; i < length; i++) {
        if (radioBtns[i].checked) {
          twitch.configuration.set("broadcaster", "", radioBtns[i].id);
          log("saveSettings() fired, broadcaster-selected sku set to: " + radioBtns[i].id);
          break;
        }
      }
    }

    function compare(a, b) {
      if (a.displayName > b.displayName) {
        return -1;
      }
      if (a.displayName < b.displayName) {
        return 1;
      }

      return 0;
    }
  </script>

  <div class="nes-container is-dark with-title">
    <p class="title" id="configuration">Configuration</p>
    <div>
      <button type="button" class="nes-btn is-primary" onclick="saveSettings()" id="btn_save">Save</button>
    </div>
  </div>
</body>

</html>